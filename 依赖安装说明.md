# 依赖安装说明

## 更新内容

已更新 `requirements.txt` 文件，添加了所有项目必需的依赖包。

### 新增的依赖

1. **torch, torchvision, torchaudio** - PyTorch 深度学习框架（核心依赖）
2. **numpy<2.0.0** - 数值计算库（mediapipe 要求 numpy<2）
3. **opencv-python** - 图像处理库（cv2）
4. **requests** - HTTP 请求库（server.py 需要）
5. **pandas** - 数据处理库
6. **pillow** - 图像处理库

### 修正的依赖

- `kaldi_native_fbank` → `kaldi-native-fbank`（正确的包名）

### 版本要求

- **Python**: 3.8-3.11（推荐 3.11）
- **numpy**: <2.0.0（mediapipe 兼容性要求）

## 安装步骤

### 1. 激活 conda 环境

```bash
conda activate dh_live
```

### 2. 安装所有依赖

```bash
# 方法1：直接安装（推荐）
pip install -r requirements.txt

# 方法2：如果网络较慢，使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 3. 验证安装

```bash
# 运行环境检查脚本
python check_environment.py

# 或手动检查核心依赖
python -c "import torch; import cv2; import numpy; import requests; import mediapipe; print('All dependencies installed successfully')"
```

## 依赖分类说明

### 核心依赖
- `torch`, `torchvision`, `torchaudio` - 深度学习框架
- `numpy<2.0.0` - 数值计算
- `opencv-python` - 图像处理

### 音频处理
- `kaldi-native-fbank` - 音频特征提取
- `soundfile` - 音频文件处理
- `sherpa-onnx` - 语音识别和合成

### 图像处理和计算机视觉
- `mediapipe` - 人脸检测和面部网格
- `scipy` - 科学计算

### 机器学习
- `scikit-learn` - 机器学习工具
- `tqdm` - 进度条显示

### 3D渲染和图形
- `pyglm` - OpenGL 数学库
- `glfw` - OpenGL 窗口管理
- `PyOpenGL` - Python OpenGL 绑定

### Web框架
- `gradio>=5.0.0` - Web 界面框架
- `fastapi` - 异步 Web 框架
- `uvicorn` - ASGI 服务器
- `requests` - HTTP 客户端

### API服务
- `openai` - OpenAI API 客户端

### 其他工具
- `pandas` - 数据处理
- `pillow` - 图像处理

## 常见问题

### Q1: numpy 版本冲突

**问题**: `mediapipe 0.10.21 has requirement numpy<2, but you have numpy 2.2.6`

**解决**:
```bash
# 卸载旧版本
pip uninstall numpy

# 安装兼容版本
pip install "numpy<2.0.0"
```

### Q2: mediapipe 安装失败

**问题**: `ERROR: No matching distribution found for mediapipe`

**解决**:
1. 确保 Python 版本在 3.8-3.11 之间
2. 使用指定版本安装：
```bash
pip install mediapipe==0.10.9
```

### Q3: torch 安装很慢

**解决**: 使用国内镜像或指定源
```bash
# 使用清华镜像
pip install torch torchvision torchaudio -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或使用 PyTorch 官方源
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### Q4: 缺少某个依赖

**解决**: 检查 `requirements.txt` 是否包含该依赖，然后：
```bash
# 安装单个包
pip install package_name

# 或重新安装所有依赖
pip install -r requirements.txt --upgrade
```

## 完整依赖列表

查看 `requirements.txt` 文件获取完整的依赖列表和版本要求。

## 更新日期

2025-01-27

