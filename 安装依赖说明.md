# 安装依赖说明

## 问题：ModuleNotFoundError: No module named 'cv2'

这个错误是因为缺少 `opencv-python` 包，但更重要的是，您当前使用的 Python 版本（3.13.9）与项目要求不匹配。

## 解决方案

### 方案1：使用正确的 Conda 环境（推荐）

项目要求使用 Python 3.8-3.11，而您当前使用的是 Python 3.13.9。

#### 步骤1：创建正确的环境

```bash
# 创建名为 dh_live 的环境，使用 Python 3.11
conda create -n dh_live python=3.11

# 激活环境
conda activate dh_live
```

#### 步骤2：安装依赖

```bash
# 进入项目目录
cd D:\work\DH_live

# 安装 PyTorch（CPU版本）
pip install torch

# 安装其他依赖
pip install -r requirements.txt

# 安装 opencv-python（如果 requirements.txt 中没有）
pip install opencv-python
```

#### 步骤3：验证安装

```bash
python -c "import cv2; print('OpenCV:', cv2.__version__)"
python -c "import mediapipe; print('Mediapipe: OK')"
python -c "import numpy; print('NumPy: OK')"
```

### 方案2：在当前环境安装 opencv-python（临时方案）

如果您暂时不想切换环境，可以先安装 opencv-python：

```bash
pip install opencv-python
```

**注意**：mediapipe 可能无法在 Python 3.13 上安装，建议还是使用方案1。

---

## 完整的依赖安装步骤

### 1. 确保使用正确的 Python 版本

```bash
# 检查当前 Python 版本
python --version

# 应该是 Python 3.8-3.11，如果是 3.12+，需要创建新环境
```

### 2. 创建并激活环境

```bash
# 创建环境
conda create -n dh_live python=3.11 -y

# 激活环境
conda activate dh_live
```

### 3. 安装所有依赖

```bash
# 安装 PyTorch（根据您的系统选择）

# CPU 版本
pip install torch

# GPU 版本（如果有 NVIDIA GPU）
pip install torch --index-url https://download.pytorch.org/whl/cu124

# 安装项目依赖
pip install -r requirements.txt

# 安装额外的依赖（如果 requirements.txt 中没有）
pip install opencv-python numpy
```

### 4. 验证安装

```bash
python -c "import cv2; print('✅ OpenCV 安装成功')"
python -c "import mediapipe; print('✅ Mediapipe 安装成功')"
python -c "import numpy; print('✅ NumPy 安装成功')"
python -c "import torch; print('✅ PyTorch 安装成功')"
```

---

## 常见问题

### Q1: mediapipe 安装失败

**原因**：Python 版本过高（3.12+）

**解决**：使用 Python 3.11 或更低版本

```bash
conda create -n dh_live python=3.11
conda activate dh_live
pip install mediapipe
```

### Q2: 使用国内镜像加速

如果下载很慢，可以使用清华镜像：

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q3: 检查已安装的包

```bash
pip list | findstr opencv
pip list | findstr mediapipe
pip list | findstr numpy
```

---

## 快速修复当前错误

如果您想快速修复当前的错误（临时方案）：

```bash
# 安装 opencv-python
pip install opencv-python

# 然后重新运行脚本
python data_preparation_mini.py muted.mp4 video_data/my_character
```

**但建议**：还是切换到正确的 Python 环境，避免后续问题。

